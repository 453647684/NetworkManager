<job $JOBTYPE>
	<whiteboard>
		$WHITEBOARD $UUID
		$ARGV $ARGV_PROFILE
	</whiteboard>
	<recipeSet priority="Normal">
		<recipe kernel_options="$SELINUX_DISABLED" kernel_options_post="" ks_meta="" role="None" whiteboard="$WHITEBOARD $UUID">
			<autopick random="true"/>
			<watchdog panic="None"/>
			<packages/>
			<ks_appends>
				<!-- A workaround for rdma machine post-deploy script woes, suggested by honli -->
				<ks_append><![CDATA[%post
sed -e '/^\s*linux16\s*\/vmlinuz/ s/$/ $SELINUX_DISABLED/' -i /boot/grub2/grub.cfg || :
%end
]]>
				</ks_append>
			</ks_appends>
			<repos/>
			<distroRequires>
				<and>
					<!--<distro_family op="=" value="$DISTRO_FAMILY"/>-->
					<distro_name op="=" value="$DISTRO_NAME"/>
					<distro_variant op="=" value="$DISTRO_VARIANT"/>
					<distro_method op="=" value="$DISTRO_METHOD"/>
					<distro_arch op="=" value="$DISTRO_ARCH"/>
				</and>
			</distroRequires>
			<hostRequires>
				<and>
					<arch op="=" value="x86_64"/>
					<!-- default -->    <!-- <group op="=" value="desktopqe-net"/> -->
					<!-- veth -->       <!-- <group op="=" value="desktop"/> -->
					<!-- dcb -->        <!-- <hostname op="=" value="wsfd-netdev7.lab.bos.redhat.com"/> -->
					<!-- infiniband --> <!-- <hostname op="=" value="rdma-qe-11.lab.bos.redhat.com"/> -->
					<!-- wifi -->       <!-- <group op="=" value="wireless"/><hostname op="like" value="wlan-r2%.wlan.rhts.eng.bos.redhat.com"/> -->
					<!-- wifi -->       <!-- <hostname op="=" value="wlan-r2s26.wlan.rhts.eng.bos.redhat.com"/> -->
					$HOSTREQUIRES
				</and>
				<system_type value="Machine"/>
			</hostRequires>
			<partitions/>
			<task name="/distribution/command" role="STANDALONE">
				<params>
					<param name="CMDS_TO_RUN" value="
						    sed -i -e 's/^ *\(Storage\|SystemMaxUse\|RateLimitBurst\|RateLimitInterval\)=.*/#\0/'
						           -e '$$a\Storage=persistent'
						           -e '$$a\SystemMaxUse=2G'
						           -e '$$a\RateLimitBurst=0/'
						           -e '$$a\RateLimitInterval=0/'
						           /etc/systemd/journald.conf ;
						    systemctl restart systemd-journald.service ;
						"/>
				</params>
			</task>
			<task name="/distribution/pkginstall" role="STANDALONE">
				<params>
					<param name="PKGARGNAME" value="python-setuptools python-netaddr pexpect bash-completion iw net-tools teamd NetworkManager radvd wireshark git firewalld psmisc bridge-utils"/>
				</params>
			</task>
			<task name="/distribution/command" role="STANDALONE">
				<params>
					<param name="CMDS_TO_RUN" value="mkdir -p /etc/NetworkManager/conf.d/; printf '[main]\n    debug=$CONF_DEBUG\n    dhcp=$CONF_DHCP\n\n[logging]\n    level=$CONF_LOGLEVEL\n    domains=ALL\n\n' > /etc/NetworkManager/conf.d/99-test.conf"/>
				</params>
			</task>
			<task name="/distribution/command" role="STANDALONE">
				<params>
					<param name="CMDS_TO_RUN" value="yum install -y yum $RPM_LIST"/>
				</params>
			</task>
			<task name="/distribution/command" role="STANDALONE">
				<params>
					<param name="CMDS_TO_RUN" value="systemctl restart NetworkManager.service"/>
				</params>
			</task>
			<task name="/qe/desktop/simpletestharness" role="STANDALONE">
				<params>
					<param name="GIT_TARGETBRANCH" value="$GIT_TARGETBRANCH"/>
					<param name="TESTS" value="$TESTS"/>
					<param name="TEST_MAPPER" value="True"/>
					<param name="COMPONENT" value="NetworkManager"/>
					<param name="GIT_URL" value="$GIT_URL"/>
					<param name="TYPE" value="TEST"/>
				</params>
			</task>
			<task name="/distribution/command" role="STANDALONE">
				<params>
					<param name="CMDS_TO_RUN" value="journalctl -b &gt; /tmp/journal_all.log; rhts-submit-log -l '/tmp/journal_all.log'"/>
				</params>
			</task>
			$RESERVESYS
		</recipe>
	</recipeSet>
</job>

