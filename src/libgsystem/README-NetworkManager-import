This code is copied from:

http://git.gnome.org/browse/libgsystem

Please send any patches there!
